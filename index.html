<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>What's New | unearth.fyi</title>
    <meta name="description" content="The latest news, announcements, and micro-updates from the unearth.im brand foundry.">

    <!-- SEO & Open Graph Tags -->
    <meta property="og:title" content="What's New | unearth.fyi">
    <meta property="og:description" content="The latest news, announcements, and micro-updates from the unearth.im foundry.">
    <meta property="og:image" content="https://placehold.co/1200x630/F8F7F4/2E2E2E?text=What%27s+New">
    <meta property="og:url" content="https://unearth.fyi">
    <meta property="og:type" content="website">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="What's New | unearth.fyi">
    <meta name="twitter:description" content="The latest news, announcements, and micro-updates from the unearth.im foundry.">
    <meta name="twitter:image" content="https://placehold.co/1200x630/F8F7F4/2E2E2E?text=What%27s+New">

    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://unearth.fyi">

    <!-- Typography (Lora for Serif/Narrative, Inter for Sans/UI) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lora:ital,wght@0,400;0;500;0;600;0,700;1,400&display=swap" rel="stylesheet">

    <!-- Tailwind v3.4.1 -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- unearth.im Standard Configuration (Earth & Ink Palette) -->
    <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            // 'Earth & Ink' Palette (Light Mode)
            'background': '#F8F7F4', // Off-White
            'text': '#2E2E2E',       // Charcoal
            'accent-primary': '#A95C3D', // Burnt Sienna
            'accent-secondary': '#5A7D8C', // Slate Blue
          },
          fontFamily: {
            // 'The Manuscript & The Interface' Typography
            'serif': ['Lora', 'serif'],
            'sans': ['Inter', 'sans-serif'],
          }
        }
      }
    }
    </script>
</head>
<body class="bg-background text-text font-serif antialiased">

    <div class="relative min-h-screen py-24 px-4 sm:px-6 lg:px-8">

        <!-- Main Content -->
        <main class="max-w-3xl mx-auto" role="main">

            <!-- 'Grounded' Navigation -->
            <div class="mb-12 text-center sm:text-left">
                <!-- UI Element: Uses font-sans (Inter) -->
                <a href="https://unearth.im" class="font-sans text-sm font-semibold tracking-wide uppercase text-text/70 hover:text-text transition-colors" aria-label="Back to unearth.im home">
                    &larr; Back to unearth.im
                </a>
            </div>

            <section class="text-center">
                <!-- Narrative Element: Uses font-serif (Lora) -->
                <h1 class="text-5xl md:text-7xl font-medium tracking-tight text-text">
                    unearth<span class="text-accent-primary">.fyi</span>
                </h1>
                
                <!-- Narrative Element: Uses font-serif (Lora) -->
                <article class="mt-8 text-lg md:text-xl leading-relaxed text-text/90 max-w-2xl mx-auto">
                    <p>
                        The latest news, announcements, and micro-updates from the foundry. For your information.
                    </p>
                </article>
            </section>

            <!-- 
              ===============================================================
              FIREBASE FEED TARGET
              ===============================================================
            -->
            <section class="mt-16 max-w-2xl mx-auto">
                <!-- Each post will be injected here, spaced out just like the lexicon -->
                <div id="feed-target" class="space-y-20">
                    
                    <!-- Loading State -->
                    <div id="loading-state">
                        <p class="mt-2 text-lg leading-relaxed text-text/90 text-center">
                            Loading posts...
                        </p>
                    </div>

                </div>
            </section>
            
        </main>

        <!-- Footer -->
        <footer class="">
            <div class="max-w-7xl mx-auto text-center py-12 mt-24 px-4 sm:px-6 lg:px-8">
                <!-- UI Element: Uses font-sans (Inter) -->
                <p class="font-sans text-base text-text/60">
                    &copy; <span id="current-year"></span> <a href="https://unearth.im" class="hover:text-accent-primary transition-colors" target="_blank" rel="noopener">unearth<span class="text-accent-primary">.im</span></a> &ndash; <a href="https://unearth.im/museum/" target="_blank" rel="noopener" class="hover:text-accent-primary transition-colors">Archive &amp; Anvil</a>
                </p>
            </div>
        </footer>
    </div>

    <!-- 
      ===============================================================
      FIREBASE SCRIPT
      ===============================================================
    -->
    <script type="module">
        // 1. Import functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            query, 
            orderBy, 
            limit, 
            onSnapshot 
        } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
        
        // 2. Your web app's Firebase configuration
        // (Remember to replace this with your NEWLY rotated key!)
        const firebaseConfig = {
          apiKey: "AIzaSyAEU3QcCzu4ZmwJpHhogu1hMpyRp2swUz8", // <-- PUT YOUR NEW KEY HERE
          authDomain: "jojo-4b593.firebaseapp.com",
          projectId: "jojo-4b593",
          storageBucket: "jojo-4b593.firebasestorage.app",
          messagingSenderId: "353107431611",
          appId: "1:353107431611:web:01ee6c26cf7632d744599e",
          measurementId: "G-W1QL3RK32R"
        };

        // 3. Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 4. Get the DOM elements
        const feedTarget = document.getElementById("feed-target");
        const loadingState = document.getElementById("loading-state");
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // 5. Create the Firestore query
        const postsCollection = collection(db, "microblog");
        const q = query(postsCollection, orderBy("timestamp", "desc"), limit(25));

        // 6. Listen for real-time updates
        onSnapshot(q, 
            (snapshot) => {
                // Clear the loading state
                feedTarget.innerHTML = ""; 

                if (snapshot.empty) {
                    feedTarget.innerHTML = `
                        <p class="mt-2 text-lg leading-relaxed text-text/90 text-center">
                            No posts yet. Check back soon.
                        </p>
                    `;
                    return;
                }

                // Loop through each post and build HTML
                snapshot.forEach(doc => {
                    const post = doc.data();
                    
                    // Format the timestamp
                    const timestamp = post.timestamp.toDate();
                    const formattedDate = timestamp.toLocaleString(undefined, {
                        dateStyle: 'medium',
                        timeStyle: 'short'
                    });
                    
                    // Create the permalink
                    const permalink = `post.html?id=${doc.id}`;

                    // Check for an image
                    let imageHtml = '';
                    if (post.imageUrl) {
                        // *** This block was fixed ***
                        imageHtml = `
                            <img src="${post.imageUrl}" alt="post image" 
                                 class="mt-4 mb-6 rounded-lg border border-text/20 w-full object-cover">
                        `;
                    }

                    // Create the HTML for a single post
                    const postElement = document.createElement('div');
                    // *** ADDED: These classes create the "card" look ***
                    postElement.className = 'bg-white rounded-lg shadow-sm border border-text/20 p-6 md:p-8';
                    
                    // This HTML structure matches the lexicon item style from your template
                    postElement.innerHTML = `
                        <!-- UI Element: Term uses font-sans (Inter) -->
                        <h2 class="font-sans text-xl font-semibold tracking-tight text-text">
                            <!-- *** EDITED: Removed underline classes *** -->
                            <a href="${permalink}" class="text-accent-primary hover:text-accent-primary/80 transition-colors">
                                ${formattedDate}
                            </a>
                        </h2>
                        
                        <!-- Narrative Element: Definition uses font-serif (Lora) -->
                        <div class="mt-2 text-lg leading-relaxed text-text/90">
                            ${post.content}
                            ${imageHtml}
                        </div>
                    `;
                    
                    feedTarget.appendChild(postElement);
                });
            },
            (error) => {
                console.error("Error fetching posts: ", error);
                loadingState.innerHTML = `
                    <p class="mt-2 text-lg leading-relaxed text-red-600 text-center">
                        Error loading posts. Please try again later.
                    </p>
                `;
            }
        );
    </script>
</body>
</html>