<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Title & Meta will be updated by JS -->
    <title>Loading Post... | unearth.fyi</title>
    <meta name="description" content="A post from the unearth.fyi foundry.">
    <meta name="robots" content="noindex"> <!-- You can change this to "index" later -->

    <!-- SEO & Open Graph Tags -->
    <meta property="og:title" content="Loading Post... | unearth.fyi">
    <meta property="og:description" content="A post from the unearth.fyi foundry.">
    
    <!-- Typography (Lora for Serif/Narrative, Inter for Sans/UI) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lora:ital,wght@0,400;0;500;0;600;0,700;1,400&display=swap" rel="stylesheet">

    <!-- Tailwind v3.4.1 -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- unearth.im Standard Configuration (Earth & Ink Palette) -->
    <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'background': '#F8F7F4', // Off-White
            'text': '#2E2E2E',       // Charcoal
            'accent-primary': '#A95C3D', // Burnt Sienna
            'accent-secondary': '#5A7D8C', // Slate Blue
          },
          fontFamily: {
            'serif': ['Lora', 'serif'],
            'sans': ['Inter', 'sans-serif'],
          }
        }
      }
    }
    </script>
</head>
<body class="bg-background text-text font-serif antialiased">

    <div class="relative min-h-screen py-24 px-4 sm:px-6 lg:px-8">

        <!-- Main Content -->
        <main class="max-w-3xl mx-auto" role="main">

            <!-- 'Grounded' Navigation -->
            <div class="mb-12 text-center sm:text-left">
                <a href="index.html" class="font-sans text-sm font-semibold tracking-wide uppercase text-text/70 hover:text-text transition-colors" aria-label="Back to all posts" id="back-link">
                    &larr; Back to all posts
                </a>
            </div>

            <section class="text-center">
                <h1 class="text-5xl md:text-7xl font-medium tracking-tight text-text">
                    unearth<span class="text-accent-primary">.fyi</span>
                </h1>
                <article class="mt-8 text-lg md:text-xl leading-relaxed text-text/90 max-w-2xl mx-auto">
                    <p>A post from the foundry.</p>
                </article>
            </section>

            <!-- 
              ===============================================================
              FIREBASE SINGLE POST TARGET
              ===============================================================
            -->
            <section class="mt-16 max-w-2xl mx-auto">
                <div id="post-target">
                    
                    <!-- Loading State -->
                    <div id="loading-state">
                        <p class="mt-2 text-lg leading-relaxed text-text/90 text-center">
                            Loading post...
                        </p>
                    </div>

                </div>
            </section>
            
        </main>

        <!-- Footer -->
        <footer class="">
            <div class="max-w-7xl mx-auto text-center py-12 mt-24 px-4 sm:px-6 lg:px-8">
                <p class="font-sans text-base text-text/60">
                    &copy; <span id="current-year"></span> <a href="https://unearth.im" class="hover:text-accent-primary transition-colors" target="_blank" rel="noopener">unearth<span class="text-accent-primary">.im</span></a> &ndash; <a href="https://unearth.im/museum/" target="_blank" rel="noopener" class="hover:text-accent-primary transition-colors">Archive &amp; Anvil</a>
                </p>
            </div>
        </footer>
    </div>

    <!-- 
      ===============================================================
      FIREBASE SCRIPT (for SINGLE POST)
      ===============================================================
    -->
    <script type="module">
        // 1. Import functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { 
            getFirestore, 
            doc, 
            getDoc 
        } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        // 2. Your web app's Firebase configuration
        // (Remember to replace this with your NEWLY rotated key!)
        const firebaseConfig = {
          apiKey: "AIzaSyAEU3QcCzu4ZmwJpHhogu1hMpyRp2swUz8", // <-- PUT YOUR NEW KEY HERE
          authDomain: "jojo-4b593.firebaseapp.com",
          projectId: "jojo-4b593",
          storageBucket: "jojo-4b593.firebasestorage.app",
          messagingSenderId: "353107431611",
          appId: "1:353107431611:web:01ee6c26cf7632d744599e",
          measurementId: "G-W1QL3RK32R"
        };

        // 3. Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 4. Get the DOM elements
        const postTarget = document.getElementById("post-target");
        const loadingState = document.getElementById("loading-state");
        const backLink = document.getElementById("back-link");
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // 5. Get the post ID from the URL
        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get('id');
        
        // Set back-link to the main page (assuming it's at the root or 'index.html')
        // Use './' to go to the root of the current directory.
        backLink.href = './'; 

        async function fetchPost() {
            if (!postId) {
                postTarget.innerHTML = `<p class="mt-2 text-lg leading-relaxed text-red-600 text-center">Error: No post ID provided.</p>`;
                return;
            }

            try {
                const postRef = doc(db, "microblog", postId);
                const docSnap = await getDoc(postRef);

                // *** FIXED: This block was broken by stray diff comments ***
                if (docSnap.exists()) {
                    // --- Post Found! ---
                    const post = docSnap.data();
                    
                    // Format the timestamp
                    const timestamp = post.timestamp.toDate();
                    const formattedDate = timestamp.toLocaleString(undefined, {
                        dateStyle: 'medium',
                        timeStyle: 'short'
                    });

                    // Check for an image
                    let imageHtml = '';
                    if (post.imageUrl) {
                        imageHtml = `
                          <img src="${post.imageUrl}" alt="post image" 
                               class="mt-4 mb-6 rounded-lg border border-text/20 w-full object-cover">
                        `;
                    }
                    
                    // *** This wraps the single post in the card style ***
                    postTarget.className = 'bg-white rounded-lg shadow-sm border border-text/20 p-6 md:p-8';

                    // Build the HTML
                    postTarget.innerHTML = `
                        <h2 class="font-sans text-xl font-semibold tracking-tight text-text">
                            <span class="text-accent-primary">${formattedDate}</span>
                        </h2>
                        <div class="mt-2 text-lg leading-relaxed text-text/90">
                            ${post.content}
                            ${imageHtml}
                        </div>
                    `;
                    
                    // --- Update Meta Tags ---
                    const excerpt = (post.content.substring(0, 100) + "...").replace(/<[^>]+>/g, '');
                    document.title = `${excerpt} | unearth.fyi`;
                    document.querySelector('meta[name="description"]').setAttribute("content", excerpt);
                    document.querySelector('meta[property="og:title"]').setAttribute("content", `${excerpt} | unearth.fyi`);
                    document.querySelector('meta[property="og:description"]').setAttribute("content", excerpt);
                    document.querySelector('meta[name="twitter:title"]').setAttribute("content", `${excerpt} | unearth.fyi`);
                    document.querySelector('meta[name="twitter:description"]').setAttribute("content", excerpt);
                    
                    // Set OG image if post has one
                    if(post.imageUrl) {
                        document.querySelector('meta[property="og:image"]').setAttribute("content", post.imageUrl);
                        document.querySelector('meta[name="twitter:image"]').setAttribute("content", post.imageUrl);
                    }
                    
                    // Allow indexing
                    document.querySelector('meta[name="robots"]').setAttribute("content", "index, follow");

                } else {
                    postTarget.innerHTML = `<p class="mt-2 text-lg leading-relaxed text-text/90 text-center">Error: Post not found.</p>`;
                }
                // *** End of fixed block ***

            } catch (error) {
                console.error("Error fetching post: ", error);
                postTarget.innerHTML = `<p class="mt-2 text-lg leading-relaxed text-red-600 text-center">Error loading post.</p>`;
            }
        }

        // 6. Run the function
        fetchPost();
    </script>
</body>
</html>